<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="VivaVoz.Views.RecordingDetailView">
  <Grid>
    <TextBlock Text="Select a recording to view details."
               TextAlignment="Center"
               VerticalAlignment="Center"
               HorizontalAlignment="Center"
               Opacity="0.7"
               IsVisible="{Binding NoSelection}" />

    <ScrollViewer IsVisible="{Binding HasSelection}">
      <StackPanel Spacing="16">

        <!-- Title row with Delete button -->
        <Grid ColumnDefinitions="*, Auto">
          <TextBlock Grid.Column="0"
                     Text="{Binding SelectedRecording.Title, TargetNullValue='Untitled recording'}"
                     FontSize="20"
                     FontWeight="SemiBold"
                     VerticalAlignment="Center" />
          <Button Grid.Column="1"
                  Command="{Binding Detail.DeleteCommand}"
                  Content="Delete"
                  IsVisible="{Binding Detail.IsNotEditing}"
                  FontSize="12"
                  Padding="8,2" />
        </Grid>

        <StackPanel Orientation="Horizontal" Spacing="24">
          <StackPanel>
            <TextBlock Text="Date" FontSize="12" Opacity="0.7" />
            <TextBlock Text="{Binding SelectedRecording.CreatedAt, StringFormat='{}{0:MMM dd, yyyy HH:mm}'}" />
          </StackPanel>
          <StackPanel>
            <TextBlock Text="Duration" FontSize="12" Opacity="0.7" />
            <TextBlock Text="{Binding SelectedRecording.Duration, StringFormat='{}{0:hh\\:mm\\:ss}'}" />
          </StackPanel>
          <StackPanel>
            <TextBlock Text="Status" FontSize="12" Opacity="0.7" />
            <TextBlock Text="{Binding SelectedRecording.Status}" />
          </StackPanel>
          <StackPanel>
            <TextBlock Text="Language" FontSize="12" Opacity="0.7" />
            <TextBlock Text="{Binding SelectedRecording.LanguageCode, Converter={StaticResource LanguageCodeToName}}" />
          </StackPanel>
        </StackPanel>

        <Border Padding="12"
                BorderThickness="1"
                BorderBrush="#1FFFFFFF"
                CornerRadius="6"
                IsVisible="{Binding AudioPlayer.HasAudio}"
                IsEnabled="{Binding AudioPlayer.HasAudio}">
          <StackPanel Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Button Command="{Binding AudioPlayer.TogglePlayPauseCommand}"
                      Content="{Binding AudioPlayer.PlayPauseLabel}" />
              <Button Command="{Binding AudioPlayer.StopCommand}"
                      Content="Stop" />
            </StackPanel>
            <Slider Minimum="0"
                    Maximum="1"
                    Value="{Binding AudioPlayer.Progress}"
                    IsSnapToTickEnabled="False"
                    TickFrequency="0.001" />
            <TextBlock Text="{Binding AudioPlayer.TimeDisplay}" />
          </StackPanel>
        </Border>

        <!-- Transcript Section -->
        <StackPanel Spacing="8"
                    IsVisible="{Binding ShowTranscriptSection}">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="Transcript"
                       FontSize="12"
                       Opacity="0.7"
                       VerticalAlignment="Center" />
            <!-- Transcribing indicator (animated dots via ProgressBar) -->
            <ProgressBar IsIndeterminate="True"
                         IsVisible="{Binding IsTranscribing}"
                         Width="80"
                         Height="4"
                         VerticalAlignment="Center" />
            <!-- Copy to clipboard button -->
            <Button Command="{Binding CopyTranscriptCommand}"
                    Content="{Binding CopyButtonLabel}"
                    IsVisible="{Binding CanCopyTranscript}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
            <!-- Export transcript button -->
            <Button Command="{Binding ExportTextCommand}"
                    Content="Export Text"
                    IsVisible="{Binding CanExportText}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
            <!-- Export audio button -->
            <Button Command="{Binding ExportAudioCommand}"
                    Content="Export Audio"
                    IsVisible="{Binding HasSelection}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
            <!-- (Re-)Transcribe button -->
            <Button Command="{Binding RetranscribeCommand}"
                    Content="{Binding RetranscribeButtonLabel}"
                    IsVisible="{Binding CanRetranscribe}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
            <!-- Edit button (visible when not editing) -->
            <Button Command="{Binding Detail.EditCommand}"
                    Content="Edit"
                    IsVisible="{Binding Detail.IsNotEditing}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
            <!-- Save button (visible when editing) -->
            <Button Command="{Binding Detail.SaveCommand}"
                    Content="Save"
                    IsVisible="{Binding Detail.IsEditing}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
            <!-- Cancel button (visible when editing) -->
            <Button Command="{Binding Detail.CancelCommand}"
                    Content="Cancel"
                    IsVisible="{Binding Detail.IsEditing}"
                    FontSize="12"
                    Padding="8,2"
                    VerticalAlignment="Center" />
          </StackPanel>
          <Border Padding="12"
                  BorderThickness="1"
                  BorderBrush="#1FFFFFFF"
                  CornerRadius="6"
                  MinHeight="100">
            <Panel>
              <!-- Read-only view: shown when not editing -->
              <TextBox Text="{Binding TranscriptDisplay, Mode=OneWay}"
                       IsReadOnly="True"
                       IsVisible="{Binding Detail.IsNotEditing}"
                       AcceptsReturn="True"
                       TextWrapping="Wrap"
                       BorderThickness="0"
                       Background="Transparent"
                       Padding="0">
                <TextBox.Styles>
                  <Style Selector="TextBox:pointerover /template/ Border#PART_BorderElement">
                    <Setter Property="Background" Value="Transparent" />
                  </Style>
                  <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                    <Setter Property="Background" Value="Transparent" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
              <!-- Editable view: shown when editing -->
              <TextBox Text="{Binding Detail.EditText}"
                       IsReadOnly="False"
                       IsVisible="{Binding Detail.IsEditing}"
                       AcceptsReturn="True"
                       TextWrapping="Wrap"
                       BorderThickness="0"
                       Background="Transparent"
                       Padding="0">
                <TextBox.Styles>
                  <Style Selector="TextBox:pointerover /template/ Border#PART_BorderElement">
                    <Setter Property="Background" Value="Transparent" />
                  </Style>
                  <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                    <Setter Property="Background" Value="Transparent" />
                  </Style>
                </TextBox.Styles>
              </TextBox>
            </Panel>
          </Border>
        </StackPanel>
      </StackPanel>
    </ScrollViewer>
  </Grid>
</UserControl>
