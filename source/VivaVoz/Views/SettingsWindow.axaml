<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:VivaVoz.ViewModels"
        x:Class="VivaVoz.Views.SettingsWindow"
        Title="Settings"
        Width="480"
        MinHeight="400"
        SizeToContent="Height"
        MaxHeight="700"
        CanResize="False"
        WindowStartupLocation="CenterOwner">
  <ScrollViewer>
    <StackPanel Spacing="24" Margin="24">

      <!-- General -->
      <StackPanel Spacing="12">
        <TextBlock Text="General" FontSize="16" FontWeight="SemiBold" />

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Run at Startup" VerticalAlignment="Center" />
          <CheckBox Grid.Column="1" IsChecked="{Binding RunAtStartup}" />
        </Grid>

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Minimize to Tray on Close" VerticalAlignment="Center" />
          <CheckBox Grid.Column="1" IsChecked="{Binding MinimizeToTray}" />
        </Grid>

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Theme" VerticalAlignment="Center" />
          <ComboBox Grid.Column="1"
                    ItemsSource="{x:Static vm:SettingsViewModel.AvailableThemes}"
                    SelectedItem="{Binding Theme}"
                    MinWidth="120" />
        </Grid>
      </StackPanel>

      <!-- Updates -->
      <StackPanel Spacing="12">
        <TextBlock Text="Updates" FontSize="16" FontWeight="SemiBold" />

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Check for updates on startup" VerticalAlignment="Center" />
          <CheckBox Grid.Column="1" IsChecked="{Binding CheckForUpdatesOnStartup}" />
        </Grid>

        <Grid ColumnDefinitions="*,Auto,Auto">
          <TextBlock Text="{Binding UpdateStatusMessage}"
                     VerticalAlignment="Center"
                     Opacity="0.7"
                     FontSize="12"
                     TextWrapping="Wrap" />
          <Button Grid.Column="2"
                  Content="Check for Updates"
                  Command="{Binding CheckForUpdatesCommand}"
                  Padding="8,4" />
        </Grid>
      </StackPanel>

      <!-- Recording -->
      <StackPanel Spacing="12">
        <TextBlock Text="Recording" FontSize="16" FontWeight="SemiBold" />

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Input Device" VerticalAlignment="Center" />
          <ComboBox Grid.Column="1"
                    ItemsSource="{Binding AvailableDevices}"
                    SelectedItem="{Binding AudioInputDevice}"
                    MinWidth="180"
                    PlaceholderText="Default device" />
        </Grid>

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Hotkey" VerticalAlignment="Center" />
          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
            <TextBlock Text="{Binding HotkeyDisplayText}"
                       VerticalAlignment="Center"
                       MinWidth="120" />
            <Button Content="Set"
                    Command="{Binding StartSetHotkeyCommand}"
                    IsEnabled="{Binding !IsListeningForHotkey}"
                    Padding="8,4" />
          </StackPanel>
        </Grid>

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Recording Mode" VerticalAlignment="Center" />
          <ComboBox Grid.Column="1"
                    ItemsSource="{x:Static vm:SettingsViewModel.AvailableRecordingModes}"
                    SelectedItem="{Binding RecordingMode}"
                    MinWidth="140" />
        </Grid>
      </StackPanel>

      <!-- Transcription -->
      <StackPanel Spacing="12">
        <TextBlock Text="Transcription" FontSize="16" FontWeight="SemiBold" />

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Language" VerticalAlignment="Center" />
          <ComboBox Grid.Column="1"
                    ItemsSource="{x:Static vm:SettingsViewModel.AvailableLanguageOptions}"
                    SelectedItem="{Binding SelectedLanguageOption}"
                    MinWidth="120" />
        </Grid>

        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Text="Auto-copy to clipboard" VerticalAlignment="Center" />
          <CheckBox Grid.Column="1" IsChecked="{Binding AutoCopyToClipboard}" />
        </Grid>
      </StackPanel>

      <!-- Models -->
      <StackPanel Spacing="12">
        <TextBlock Text="Models" FontSize="16" FontWeight="SemiBold" />
        <TextBlock Text="Download and manage Whisper models. Select an installed model to use for transcription."
                   FontSize="12" Opacity="0.7" TextWrapping="Wrap" />

        <ItemsControl ItemsSource="{Binding Models}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type vm:ModelItemViewModel}">
              <Border Padding="0,6">
                <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto">

                  <!-- Model info -->
                  <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="2">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                      <TextBlock Text="{Binding DisplayName}" FontWeight="Medium" />
                      <TextBlock Text="{Binding ExpectedSize}" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                    </StackPanel>
                    <TextBlock Text="{Binding StatusText}" FontSize="11" Opacity="0.7" />
                  </StackPanel>

                  <!-- Progress bar (visible during download) -->
                  <ProgressBar Grid.Column="1"
                               Value="{Binding DownloadProgress}"
                               Minimum="0" Maximum="1"
                               IsVisible="{Binding IsDownloading}"
                               Width="80" Height="4"
                               VerticalAlignment="Center"
                               Margin="8,0" />

                  <!-- Cancel button (visible during download) -->
                  <Button Grid.Column="2"
                          Content="Cancel"
                          Command="{Binding CancelDownloadCommand}"
                          IsVisible="{Binding CanCancel}"
                          Padding="8,4"
                          Margin="4,0,0,0" />

                  <!-- Download button (visible when not installed and not downloading) -->
                  <Button Grid.Column="2"
                          Content="Download"
                          Command="{Binding DownloadCommand}"
                          IsVisible="{Binding CanDownload}"
                          Padding="8,4"
                          Margin="4,0,0,0" />

                  <!-- Use button (visible when installed and not the active model) -->
                  <Button Grid.Column="3"
                          Content="Use"
                          Command="{Binding SelectCommand}"
                          IsVisible="{Binding CanSelect}"
                          Padding="8,4"
                          Margin="4,0,0,0" />

                  <!-- Active indicator (visible when this model is selected) -->
                  <TextBlock Grid.Column="3"
                             Text="Active"
                             IsVisible="{Binding IsSelected}"
                             VerticalAlignment="Center"
                             FontSize="11"
                             Opacity="0.7"
                             Margin="4,0,0,0" />

                  <!-- Delete button (visible when installed and not downloading) -->
                  <Button Grid.Column="4"
                          Content="Delete"
                          Command="{Binding DeleteCommand}"
                          IsVisible="{Binding CanDelete}"
                          Padding="8,4"
                          Margin="4,0,0,0" />

                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>

    </StackPanel>
  </ScrollViewer>
</Window>
